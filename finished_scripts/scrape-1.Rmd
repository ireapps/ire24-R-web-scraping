---
title: "Scrape 1"
output: 
---

Scrape the 2024 warn notices for the state of Maryland, from [https://www.dllr.state.md.us/employment/warn.shtml](https://www.dllr.state.md.us/employment/warn.shtml](https://www.dllr.state.md.us/employment/warn.shtml](https://www.dllr.state.md.us/employment/warn.shtml).

Libraries: we'll use "rvest" to pull and parse HTML from a website, and "tidyverse" to clean and manipulate the data we scrape into a tidy table (a "tibble" in tidyverse lingo). 

If you need to install these packages, run the following code chunk: 
```{r}
install.packages(c("tidyverse","rvest"))
```

Load the packages:
```{r}
library(tidyverse)
library(rvest)
```

Read the source HTML from the webpage:
```{r}
url <- "https://www.dllr.state.md.us/employment/warn.shtml"

html <- read_html(url)
```

The entire HTML document from that webpage is now in your R environment, but it's not easy to view in this form. It says "List of 2" because it's reading the highest-level tags in the HTML: <head> and <body>. The rest of it is there as well, but it's easier to use Chrome Inspect to sift through the HTML as you figure out what elements you need to pull. 

To pull a particular element, use the html_element() or html_elements() function. The first grabs all the matching elements and gives them to you in a flat vector; the second returns all the elements in a nodeset. (If this doesn't make sense, don't worry about it). 

For this website, our data is conveniently inside of a <table> tag, so that's the element we'll pull:
```{r}
html |> html_element("table")
```

There it is! It's not a nice tidy table yet, but we can see the data buried in <tr> and <td> tags. 
Thankfully we don't have to do much to parse this, other than use the html_table() function. 

```{r}
html |> html_element("table") |> html_table()
```

Note that the header row is part of the data. This is because those values aren't baked into <th> tags (which indicate table header), but regular <tr> tags (table row). So add an argument to html_table() so it recognizes the first row as a header: 
```{r}

# test it out
html |> html_element("table") |> html_table(header=T)

# make it permanent
table <- html |> html_element("table") |> html_table(header=T)

```

If you look at `Company` and `Location` you'll see there are `\r\n` characters baked in; we can use some of the functions from the stringr package (in tidyverse) to clean those up: 
```{r}

# test it out
table |> 
  mutate(Company = str_replace_all(Company, "\r\n", ""), 
         Location = str_replace_all(Location, "\r\n", ""))

# make it permanent
table <- table |> 
  mutate(Company = str_replace_all(Company, "\r\n", ""), 
         Location = str_replace_all(Location, "\r\n", ""))

```

Voila! Now we can export the clean table as a csv:
```{r}
write_csv("md_warn_final.csv")
```

